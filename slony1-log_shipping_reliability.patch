diff -dur -x '*.orig' -x '*~' slony1-1.1.2.orig/src/slon/remote_worker.c slony1-1.1.2/src/slon/remote_worker.c
--- slony1-1.1.2.orig/src/slon/remote_worker.c	2005-10-12 23:14:25.000000000 +0200
+++ slony1-1.1.2/src/slon/remote_worker.c	2005-11-02 12:40:01.000000000 +0100
@@ -4870,7 +4870,12 @@
 			     "commit;\n"
 			     "vacuum analyze %s.sl_setsync_offline;\n", 
 			     rtcfg_namespace);
+		if ( rc < 0 ) 
+			return -1;
 		rc = fclose(archive_fp);
+		archive_fp = NULL;
+		if ( rc < 0 ) 
+			return -1;
 		rc = rename(archive_tmp, archive_name);
 	}
 	return rc;
